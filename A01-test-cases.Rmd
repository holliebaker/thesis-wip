# Appendix A: Test Cases { - #sec:appendix }

## QEPCAD-B output for test cases

### Quasi-affine

The `QEPCAD-B` output from Example \@ref(exm:sphere) is shown below.

``` {r, child="test-cases/sphere.Rmd"}

```

### Monotone

The `QEPCAD-B` output from Example \@ref(exm:qanm) is shown below.

``` {r, child="test-cases/qanm.Rmd"}

```

### Frontier Condition

The `QEPCAD-B` output from Example \@ref(exm:fr-3-whitney-jhd) is shown below.

``` {r, child="test-cases/fr-3-whitney-jhd.Rmd"}

```

## Additional test cases

We first present a few variations of Example \@ref(exm:qanm), to test various situations. The following Example \@ref(exm:qanm-3-alg) requires an algebraic refinement point.

::: {.example #qanm-3-alg }
Let $n = 3$ and consider the 2-dimensional section cell
$$
C := \{ (x,y,z) \in \R^3 \mid 0 < x < 1, y > 0, y - x^2 + 2x < 1, z = x^2 + y^2 \}.
$$
:::

The following projection and refinement polynomials are produced, along with one refinement point. 
\begin{align*}
\text{Projection polynomials:}\\
A_{1,1} & = input\\
        & = x\\
A_{1,2} & = fac2(J_{1,1}) = fac2(res(A_{2,1}|A_{2,2}))\\
        & = x - 1\\
M_{1,3} & = fac(K_{1,3}) = fac(input)\\
        & = 2 x^3 - 6 x^2 + 7 x - 2\\
M_{1,4} & = fac(K_{1,6}) = fac(input)\\
        & = 8 x - 9\\
A_{2,1} & = input\\
        & = y\\
A_{2,2} & = input\\
        & = y - x^2 + 2 x - 1\\
A_{3,1} & = input\\
        & = z - y^2 - x^2
\text{Refinement points:}\\
R_{1,1} & = input \text{ *** Refinement of cell (3) ***}\\
        & = \text{The sample point is in a PRIMITIVE representation.}\\
\alpha  & = \text{the unique root of } 2 x^3 - 6 x^2 + 7 x - 2 \text{ between } 1/4 \text{ and } 1/2\\
\text{Coordinate }1 & = \alpha \approx 0.4102\ldots
\end{align*} \begin{align*}
\text{Original cell:}
& C_{(3,3,2)} \\
& \text{The sample point is in a PRIMITIVE representation.}\\
\text{Coordinate }1 & = 1/2 = 0.5000000000\\
\text{Coordinate }2 & = 1/8 = = 0.1250000000\\
    \text{Coordinate }3 & = 19/64 = 0.2968750000\\
\text{Refined cells: }
& C_{(3,3,2)}\\
& \text{The sample point is in a PRIMITIVE representation.}\\
\text{Coordinate }1 & = 13/64 = 0.2031250000\\
\text{Coordinate }2 & = 1/4 = 0.2500000000\\
    \text{Coordinate }3 & = 425/4096 \approx 0.1037597656\ldots\\
& C_{(4,3,2)} \\
& \text{The sample point is in an EXTENDED representation.}\\
\alpha & = \text{the unique root of } 2 x^3 - 6 x^2 + 7 x - 2 \text{ between } 3/8 \text{ and } 7/16 \\
\text{Coordinate }1 & = \alpha \approx 0.4102454877\ldots\\
\text{Coordinate }2 & = 1/8 = 0.1250000000\\
\text{Coordinate }3 & = \text{the unique root of } \\
& 262144 x^3 - 536576 x^2 + 1654976 x - 287873 \text{ between } 0 \text{ and } 4\\
                    & \approx 0.1839263602\ldots\\
& C_{(5,3,2)} \\
& \text{The sample point is in a PRIMITIVE representation.}\\
\text{Coordinate }1 & = 1/2 = 0.5000000000\\
\text{Coordinate }2 & = 1/16 = 0.0625000000\\
\text{Coordinate }3 & = 65/256 = 0.2539062500
\end{align*}

Example \@ref(exm:qanm-4-rat), which follows, demonstrates what happens on sub-CADs above 0-dimensional cells.

::: {.example #qanm-4-rat }
Let $n = 4$ and consider the semialgebraic set defined by the QFF
$$
F := ( ( 4 w = 7 \lor w^2 = 36 ) \land x > 0 \land x < 1 \land y > 0 \land x + y < 1 \land z = w x^2 + y^2 ).
$$
It has three connected components, $C_1$, $C_2$ and $C_3$, each of which is a cylindrical section cell in a sub-CAD of $\R^3$ above a $0$-dimensional cell ($\mathbf{b}_1$, $\mathbf{b}_2$, $\mathbf{b}_3$ respectively).
\begin{align*}
\mathbf{b}_1 &= 7/4, &C_1 = \{ (x,y,z) \in \R^3 \mid x > 0 ,x < 1 ,y > 0 ,x + y < 1 ,z = 7/4 x^2 + y^2 \}.\\
\mathbf{b}_2 &= -6, &C_3 = \{ (x,y,z) \in \R^3 \mid x > 0 ,x < 1 ,y > 0 ,x + y < 1 ,z = -6 x^2 + y^2 \}.\\
\mathbf{b}_3 &= 6, &C_3 = \{ (x,y,z) \in \R^3 \mid x > 0 ,x < 1 ,y > 0 ,x + y < 1 ,z = 6 x^2 + y^2 \}.
\end{align*}

$C_2$ is already monotone. This can be seen by examining the projections of its top and bottom onto $\opspan{x,z}$:
\begin{align*}
C_{2,B} &= \{ -1 < x < 1, z = -6x^2 \},\\
C_{2,T} &= \{ -1 < x < 1, z = -5x - 2x + 1 \}.
\end{align*}

$C_1$ and $C_3$ are of the same kind as the cell presented in Example \@ref(exm:qanm) and require refinement.
:::

Projection polynomials and refinement points output by `QEPCAD-B` are presented below.
\begin{align*}
\text{Projection polynomials:}\\
A_{1,1} & = input\\
        & = 4 w - 7\\
A_{1,2} & = input\\
        & = w - 6\\
A_{1,3} & = input\\
        & = w + 6\\
Q_{1,4} & = fac(Q_{2,2}) = fac(input)\\
        & = w\\
A_{2,1} & = input\\
        & = x\\
A_{2,2} & = fac(J_{2,1}) = fac(res(A_{3,1}|A_{3,2}))\\
        & = x - 1\\
M_{2,3} & = fac(K_{2,4}) = fac(input)\\
        & = 5 x + 1\\
M_{2,4} & = fac(K_{2,6}) = fac(input)\\
        & = 8 x - 1\\
M_{2,5} & = fac(K_{2,7}) = fac(input)\\
        & = 7 x - 1\\
A_{3,1} & = input\\
        & = y\\
A_{3,2} & = input\\
        & = y + x - 1
\end{align*} 
\begin{align*}
\text{Refinement points:}\\
R_{2,2} & = input \text{ *** Refinement of cell (8,3) ***}\\
        & = \text{The sample point is in a PRIMITIVE representation.}\\
\text{Coordinate }1 & = 6 = 6.0000\\
\text{Coordinate }2 & = 1/7 \approx 0.1429\ldots\\
R_{2,1} & = input \text{ *** Refinement of cell (6,3) ***}\\
        & = \text{The sample point is in a PRIMITIVE representation.}\\
\text{Coordinate }1 & = 7/4 = 1.7500\\
\text{Coordinate }2 & = 1/8 = 0.1250
\end{align*} \begin{align*}
\text{Original cells: }
& C_{(6,3,3,2)} \\
& \text{The sample point is in a PRIMITIVE representation.}\\
\text{Coordinate }1 & = 7/4 = 1.7500000000\\
\text{Coordinate }2 & = 1/4 = 0.2500000000\\
\text{Coordinate }3 & = 1/4 = 0.2500000000\\
\text{Coordinate }4 & = 11/64 = 0.1718750000\\
& C_{(8,3,3,2)} \\
& \text{The sample point is in a PRIMITIVE representation.}\\
\text{Coordinate }1 & = 6 = 6.0000000000\\
\text{Coordinate }2 & = 1/4 = 0.2500000000\\
\text{Coordinate }3 & = 1/4 = 0.2500000000\\
\text{Coordinate }4 &= 7/16 = 0.4375000000\\
\end{align*} \begin{align*}
\text{Refined cells: }
& C_{(6,3,3,2)} \\
& \text{The sample point is in a PRIMITIVE representation.}\\
\text{Coordinate }1 & = 7/4 = 1.7500000000\\
\text{Coordinate }2 & = 1/16 = 0.0625000000\\
\text{Coordinate }3 & = 1/4 = 0.2500000000\\
\text{Coordinate }4 &= 71/1024 = 0.0693359375\\
& C_{(6,4,3,2)} \\
& \text{The sample point is in a PRIMITIVE representation.}\\
\text{Coordinate }1 & = 7/4 = 1.7500000000\\
\text{Coordinate }2 & = 1/8 = 0.1250000000\\
\text{Coordinate }3 & = 1/4 = 0.2500000000\\
\text{Coordinate }4 & = 23/256 = 0.0898437500\\
& C_{(6,5,3,2)} \\
& \text{The sample point is in a PRIMITIVE representation.}\\
\text{Coordinate }1 & = 7/4 = 1.7500000000\\
\text{Coordinate }2 & = 1/4 = 0.2500000000\\
\text{Coordinate }3 & = 1/4 = 0.2500000000\\
\text{Coordinate }4 & = 11/64 = 0.1718750000\\
& C_{(8,3,3,2)} \\
& \text{The sample point is in a PRIMITIVE representation.}\\
\text{Coordinate }1 & = 6 = 6.0000000000\\
\text{Coordinate }2 & = 1/4 = 0.2500000000\\
\text{Coordinate }3 & = 1/4 = 0.2500000000\\
\text{Coordinate }4 & = 7/16 = 0.4375000000\\
& C_{(8,4,3,2)} \\
& \text{The sample point is in a PRIMITIVE representation.}\\
\text{Coordinate }1 & = 6 = 6.0000000000\\
\text{Coordinate }2 & = 1/7 \approx 0.1428571429\ldots \\
\text{Coordinate }3 & = 1/4 = 0.2500000000\\
\text{Coordinate }4 & = 145/784 \approx 0.1849489796\ldots\\
& C_{(8,3,3,2)} \\
& \text{The sample point is in a PRIMITIVE representation.}\\
\text{Coordinate }1 & = 6 = 6.0000000000\\
\text{Coordinate }2 & = 1/4 = 0.2500000000\\
\text{Coordinate }3 & = 1/4 = 0.2500000000\\
\text{Coordinate }4 & = 7/16 = 0.4375000000\\
\end{align*}

The following example requires a rational refinement above an algebraic zero-cell.

::: {.example #qanm-4-above-alg }
Let $n = 4$ and consider the section cell
$$
C := \{ (w,x,y,z) \in \R^4 \mid w > 0, w^2 = 2, 0 < x < 1, y > 0, x + y < 1, z = 3x^2 + 2y^2 \}.
$$
:::

This cell lies in the sub-cad of $\R^3$ above $\sqrt{2}$. `QEPCAD` output is presented below. Note that the sample points remain in extended representation, which is how they were generated in the lifting phase. Polynomials and refinement points are as follows:
\begin{align*}
\text{Projection polynomials:}\\
A_{1,1} & = input\\
        & = w\\
A_{1,2} & = input\\
        & = w^2 - 2\\
A_{2,1} & = input\\
        & = x\\
A_{2,2} & = fac(J_{2,1}) = fac(res(A_{3,1}|A_{3,2}))\\
        & = x - 1\\
M_{2,3} & = fac(K_{2,3}) = fac(input)\\
        & = 5 x - 2\\
A_{3,1} & = input\\
        & = y\\
A_{3,2} & = input\\
        & = y + x - 1\\
A_{4,1} & = input\\
        & = z - 2 y^2 - 3 x^2\\
\text{Refinement points:}\\
R_{2,1} & = input \text{ *** Refinement of cell (6,3) ***}\\
        & = \text{The sample point is in a PRIMITIVE representation.}\\
\alpha  & = \text{the unique root of } x^2 - 2 \\
        & \text{ between } 181/128 \text{ and } 1449/1024\\
\text{Coordinate }1 & = \alpha \approx 1.4142\ldots\\
\text{Coordinate }2 & = 2/5 = 0.4000\\
\end{align*}

A rational refinement of the cell with positional index $(6,3)$ takes place. The sample points of new cells are recomputed and are stored in thee extended representation, as with the original cell. 

We now show a similar example, requiring an algebraic refinement.

::: {.example #qanm-4-alg }
Let $n = 4$ and consider the section cell
$$
C := \{ (w,x,y,z) \in \R^4 \mid w > 0, w^2 = 3, 0 < x < 1, y > 0, y < (x-1)^2, z = 3x^2 + 2y^2 \}.
$$
:::

The following polynomials and one refinement point are output by `QEPCAD-B`. The refineement point is stored in the extended represeentation. 
\begin{align*}
A_{1,1} & = input\\
        & = w\\
A_{1,2} & = input\\
        & = w^2 - 3\\
A_{2,1} & = input\\
        & = x\\
A_{2,2} & = fac2(J_{2,1}) = fac2(res(A_{3,1}|A_{3,2}))\\
        & = x - 1\\
M_{2,3} & = fac(K_{2,3}) = fac(input)\\
        & = 2 x^3 - 6 x^2 + 7 x - 2\\
M_{2,4} & = fac(K_{2,6}) = fac(input)\\
        & = 8 x - 9\\
A_{3,1} & = input\\
        & = y\\
A_{3,2} & = input\\
        & = y - x^2 + 2 x - 1\\
A_{4,1} & = input\\
        & = z - y^2 - x^2\\
R_{2,1} & = input \text{ *** Refinement of cell (6,3) ***}\\
        & = \text{The sample point is in an EXTENDED representation.}\\
\alpha  & = \text{the unique root of } x^2 - 3 \text{ between } 1773/1024 \text{ and } 887/512\\
\text{Coordinate }1 & = \alpha \approx 1.7321\ldots\\
\text{Coordinate }2 & = \text{the unique root of } 2 x^3 - 6 x^2 + 7 x - 2 \text{ between } 1/4 \text{ and } 1/2
& \approx 0.4102\ldots\\
\end{align*}

An algebraic refinement is performed. In order to recompute sample points of the refined cells, the sample points of the cells contained in $C_{(6,3)}$ (in the decomposition induced on $\R^2$) are converted back into primitive representation. For example, a new cell $C_{(6,4,3,2)}$ has thee sample point
\begin{align*}
& \text{The sample point is in an EXTENDED representation.}\\
\alpha & = \text{the unique root of } 4 x^6 - 24 x^5 + 28 x^4 + 52 x^3 - 35 x^2 - 64 x - 107\\
       & \text{ between } 17/8 \text{ and } 69/32\\
\text{Coordinate }1 & = \frac{300}{8777} \alpha^5 - \frac{1518}{8777} \alpha^4 + \frac{322}{8777} \alpha^3 + \frac{5607}{8777} \alpha^2 + \frac{6683}{8777} \alpha - \frac{9577}{8777}\\
& \approx 1.7320508076\ldots\\
\text{Coordinate }2 & = -\frac{300}{8777} \alpha^5 + \frac{1518}{8777} \alpha^4 - \frac{322}{8777} \alpha^3 - \frac{5607}{8777} \alpha^2 + \frac{2094}{8777} \alpha + \frac{9577}{8777} \\
& \approx 0.4102454877\ldots\\
\text{Coordinate }3 & = 1/8 = 0.1250000000\\
\text{Coordinate }4 & = \text{the unique root of } 262144 x^3 - 536576 x^2 + 1654976 x - 287873 \\
                    & \text{ between } 0 \text{ and } 4 \approx 0.1839263602\ldots
\end{align*}

Now consider a $(1,1,0,0)$-cell in $\R^4$ requiring two refinements.

::: {.example #qanm-4-multi }
Let $n = 4$ and consider the section cell
$$
C := \{ (w,x,y,z) \in \R^4 \mid  0 < w < 1, x > 0, w + x < 1, y = w^2 + x^2, z = 2 w^2 + x^2 \}.
$$
:::

Polynomials and refinement points as follows:
\begin{align*}
\text{Projection polynomials:}\\
A_{1,1} & = input\\
        & = w\\
A_{1,2} & = fac(J_{1,1}) = fac(res(A_{2,1}|A_{2,2}))\\
        & = w - 1\\
M_{1,3} & = fac(K_{1,4}) = fac(input)\\
        & = 3 w - 1\\
M_{1,4} & = fac(K_{1,5}) = fac(input)\\
        & = 2 w - 1
A_{2,1} & = input\\
        & = x\\
A_{2,2} & = input\\
        & = x + w - 1\\
A_{3,1} & = input\\
        & = y - x^2 - w^2\\
A_{4,1} & = input\\
        & = z - x^2 - 2 w^2\\
\text{Refinement points:}\\
R_{1,2} & = input \text{ *** Refinement of cell (3) ***}\\
        & = \text{The sample point is in a PRIMITIVE representation.}\\
\text{Coordinate }1 & = 1/2 = 0.5000\\
R_{1,1} & = input \text{ *** Refinement of cell (3) ***}\\
        & = \text{The sample point is in a PRIMITIVE representation.}\\
\text{Coordinate }1 & = 1/3 \approx 0.3333\ldots\\
\end{align*}

The following example, in $\R^5$ presents a $(1,0,1,0,0)$-cell, which requires two algebraic refinements of the CAD induced on $\R^1$. When running this test, `SACLIB` ran out of memory, so the number of available cells was doubled.

::: {.example #qanm-5-101 }
Let $n = 5$ and consider the $(1,0,1,0,0)$-cell
$$
C = \{ (w,x,y,z) \in \R^4 \mid 0 < w < 1, x = 1 - w, y > 0, w + y < 1, z = w^2 + x y^2, t = 3 w^2 + x^2 y^2 \}.
$$
:::

``` {r, child="test-cases/qanm-5-101.Rmd"}

```

::: {.example #fr-4-whitney-multi }
Let $n = 4$ and consider the semialgebraic set defined by the QFF, containing polynomials in $Z[t,x,y,z]$,
$$
F = \{ (t = 0 \lor t = 2) \land 0 < x < 1 \land -x < y < x \land y^2 - x^2 (z - t) = 0 \}.
$$
:::

The QFF defines two cylindrical cells in $\R^3$ (equipped with $(x,y,z)$), similar to those defined in Example \@ref(exm:whitney-jhd).
The following refinement points are obtained.

``` {test-fr-4-whitney-multi)
M_4,2  = input  *** Refinement of cell (6,2,2,5) ***
       = The sample point is in a PRIMITIVE representation.

alpha = the unique root of x between 0 and 0
      = 0.0000

Coordinate 1 = 2
             = 2.0000
Coordinate 2 = 0
             = 0.0000
Coordinate 3 = 0
             = 0.0000
Coordinate 4 = 3
             = 3.0000


M_4,1  = input  *** Refinement of cell (4,2,2,3) ***
       = The sample point is in a PRIMITIVE representation.

alpha = the unique root of x between 0 and 0
      = 0.0000

Coordinate 1 = 0
             = 0.0000
Coordinate 2 = 0
             = 0.0000
Coordinate 3 = 0
             = 0.0000
Coordinate 4 = 1
             = 1.0000
```

::: {.example #fr-4-whitney-alg }
Let $n = 4$ and consider the twe $2$-diemnsional subsets of the Whitney whitney umbrella defined by the QFF
$$
F = \{ (t,x,y,z) \in \R^4 \mid t^2 = 0 \land 0 < x < 1 \land -x < y < x \land y^2 - x^2 (z - t) = 0 \}.
$$
:::

THe following algebraic refinement points are produced.

``` {test-fr-4-whitney-alg}
M_4,3  = input  *** Refinement of cell (8,2,2,1) ***
       = The sample point is in an EXTENDED representation.

alpha = the unique root of x^2 - 2 between 181/128 and 1449/1024
      = 1.4142+

Coordinate 1 = alpha
             = 1.4142+
Coordinate 2 = 0
             = 0.0000
Coordinate 3 = 0
             = 0.0000
Coordinate 4 = the unique root of x^2 - 2 x - 1 between -1/2 and -1/4
             = the unique root of x^2 - 2 x - 1 between -1/2 and -1/4
             = -0.4142+


M_4,2  = input  *** Refinement of cell (2,2,2,3) ***
       = The sample point is in an EXTENDED representation.

alpha = the unique root of x^2 - 2 between -1449/1024 and -181/128
      = -1.4142+

Coordinate 1 = alpha
             = -1.4142+
Coordinate 2 = 0
             = 0.0000
Coordinate 3 = 0
             = 0.0000
Coordinate 4 = the unique root of x^2 - 2 x - 1 between 0 and 4
             = the unique root of x^2 - 2 x - 1 between 0 and 4
             = 2.4142+


M_4,1  = input  *** Refinement of cell (2,2,2,3) ***
       = The sample point is in an EXTENDED representation.

alpha = the unique root of x^2 - 2 between -1449/1024 and -181/128
      = -1.4142+

Coordinate 1 = alpha
             = -1.4142+
Coordinate 2 = 0
             = 0.0000
Coordinate 3 = 0
             = 0.0000
Coordinate 4 = the unique root of x^2 - 2 x - 1 between -1/2 and -1/4
             = the unique root of x^2 - 2 x - 1 between -1/2 and -1/4
             = -0.4142+
```

This results in the following cells above, respectively, $2,2,2)$ and $(8,2,2)$.

``` {r, child="test-cases/fr-4-whitney-alg.Rmd"}

```



More examples

- large sub-CAD, maybe R^5

- cel ls in sub-CAD of different levels

- some variations on the whitney umbrella

  - algebraic refinement point?
  - multiple levels refinement (stacked whitneys)


- whitney in a sub-CAD

- whitney with multiple refinement points above it

3D multi: multi-3.txt. many unnecesary refinements computed resulting from quasi-affine. had to use +N5000000

4D multi: it's similar, but requiring algebraic refinements. this required +N50000000 for saclib and look at how many cells it produced!
we should probably associate the quasi polynomials with the true cell so that we don't make a truly tsign-invariant CAD







