# Quasi-affine cells { #sec:quasi-affine }

Let $$
V := V_1 \cup \ldots \cup V_k
$$
be a family of semialgebraic sets such that $\dim(V_i) \le 2$ for $1\le i \le k$.
According to [@bgv15 Theorem 3.20], there is an algorithm for computing a cylindrical decomposition compatible with $V$, monotone with respect to sets $V_1,\ldots,V_k$ and satisfying the frontier condition. 
The first step is to construct a CAD $\cal D$ compatible with $V$ and such that each cell of $\cal D$ is the graph of a quasi-affine map. 
[@bgv15, Lemma 3.19] provides a procedure to do this.

## Computing the smooth twe-dimensional locus of $V$

We begin by considering $W$, the smooth $2$-dimensional locus of $V$. 
This can be done by computing a smooth stratification of $V$, e.g., using the algorithm described in Section \@ref(sec:smooth-strat). We can then compute a CAD compatible with $V$ and all strata of dimension $2$, $1$ and $0$.
Recall that the smooth stratification algorithm requires a procedure to determine whether a given semialgebraic set is empty. Algorithms for doing this, e.g., CAD or even Groebner basis can have high complexity. Therefore, we propose an alternative method. 
Let
$$
F = \{f_1,\ldots,f_s\}
$$
be the polynomials defining $V$. 
Instead of checking whether each stratum $Y_k$ is empty, we instead compute all possible partial differentials $G \subset \Z[x_1,\ldots,x_n]$. 
We can then construct a CAD $\cal D$ of $\R^n$ which has constant sign on all polynomials in $F$ and $G$. It is clear that $W$ will be a union of cells of $\cal D$. 

However, it may be possible to avoid the stratification step altogether. 
Recall from Section \@ref(sec:cad-construction)) thet smooth cells can be guaranteed by choosing a certain projection operator.
More recisely, according to [@mccallum1988 Theorems 2.2.3 and 2.2.4], if there is a finite number of blow-up poits then the McCallum projection operaton will result in a CAD with mooth cells. 
Since $\dim(V_i) \le 2$ for all $1 \le i \le k$, we may assume that blow-up points will have dimension at most $0$.
If one wishes to extend the result of @bgv15 Theorem 3.20 to sets of higher dimension, this assumption will no longer hold. In this case, we may use the Lazard projection operator [@mccallum2019].

## Ensuring that every cell is the graph of a quasi-affine map

In order to obtain quasi-affine cells, @bgv15, Lemma 3.19 states that the CAD $\cal D$ also needs to be compatible with the critical points, $W_{i}$ and $W_{i,j}$, of projections of $W$ onto one and two-dimensional coordnate subspaces (indexed by $i$ and $j$). 

Let $F = \{ f_1,\ldots,f_s \} \subset \Z[x_1,\ldots,x_n]$ be the set of polynomials defining $V$ and consider a polynomials $f \in F$. The critical points of the projection map onto $\opspan{x_i}$ can be found by computing the partial derivative and solving
$$
\dfrac{\partial f}{\partial x_i} = 0.
$$
The solutions of $\{ f = 0, \partial f / \partial x_i = 0 \}$ are the local maxima and minima of $f$ along the $x_i$-axis. Similarly, the critical points of the projection map onto the two-dimensional subspace $\opspan{x_i,x_j}$ are given by the solutions to the system
$$
\{ f = 0, \partial f / \partial x_i = 0, \partial f / \partial x_j \}.
$$
Thus, the CAD should have constant sign on the partial derivatives $\partial f / \partial x_i$ for all $1 \le i \le n$ and all $f \in F$.
Note that these first partial derivatives will have already been added if the modified smooth stratification algorithm was used to find $W$.

### Computing the quasi-affine CAD

It is clear that we want to minimise the number of input polynomials to the CAD. Therefore, the choice was made to avoid the smooth stratification algorithm and instead use the McCallum projection operator and compute a CAD sign-invariant with respect to $F = \{ f_1,\ldots,f_s \}$ their first partial derivatives
$$
\partial f_j / \partial x_i
$$
for $1 \le j \le s$ and $1 \le i \le n$. 
Denote this CAD by $\cal D$.

The reason for computing a sign-invariant CAD as opposed to one compatible with $V$ will be explained in Section \@ref(sec:frontier).


